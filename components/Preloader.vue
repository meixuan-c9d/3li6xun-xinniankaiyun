<template>
  <div class="preloader">
    <div class="preloader__cell preloader__cell--loadingText h-0 absolute inset-0 m-auto">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 162 38"><path fill-rule="evenodd" fill="#FFE6C8" d="M160.874 34.334c-.406.492-1.031.738-1.875.738-.828 0-1.473-.316-1.934-.949-.461-.633-.691-1.402-.691-2.309 0-.531.133-.961.398-1.289.266-.328.582-.566.95-.715a2.739 2.739 0 011.019-.222c.453 0 .891.113 1.313.339.422.227.765.548 1.031.961.265.415.398.887.398 1.418 0 .86-.203 1.536-.609 2.028zm-8.625.738c-.828 0-1.473-.316-1.934-.949-.461-.633-.691-1.402-.691-2.309 0-.531.133-.961.398-1.289.266-.328.582-.566.95-.715a2.739 2.739 0 011.019-.222c.453 0 .891.113 1.313.339.422.227.765.548 1.031.961.265.415.398.887.398 1.418 0 .86-.203 1.536-.609 2.028-.406.492-1.031.738-1.875.738zm-6.75 0c-.828 0-1.473-.316-1.934-.949-.461-.633-.691-1.402-.691-2.309 0-.531.133-.961.398-1.289.266-.328.582-.566.95-.715a2.739 2.739 0 011.019-.222c.453 0 .891.113 1.313.339.422.227.765.548 1.031.961.265.415.398.887.398 1.418 0 .86-.203 1.536-.609 2.028-.406.492-1.031.738-1.875.738zM135.62 15.15c-.461.36-1.113.828-1.957 1.406-1.391.938-2.539 1.805-3.445 2.602.375.36.675.711.902 1.055.226.343.34.64.34.89 0 .203-.152.457-.457.762a5.702 5.702 0 01-.996.797c-.36.227-.586.324-.68.293-1.797-.641-4.523-.961-8.18-.961-.906 0-1.586.008-2.039.023.032 1.251.118 3.602.258 7.055.094 2.75.141 4.188.141 4.312 0 .454-.223 1.035-.668 1.747a9.813 9.813 0 01-1.524 1.886c-.57.547-1.019.821-1.347.821-.188 0-.407-.094-.656-.282-.251-.187-.501-.476-.75-.867a21.202 21.202 0 00-.516-.797 14.382 14.382 0 01-.738-1.23c-.211-.399-.317-.7-.317-.903.016-.281.109-1.273.281-2.976.156-1.328.243-2.148.258-2.461.047-1.266.086-3.258.117-5.977-1.656.141-3.843.375-6.562.704l-.656.07a5.402 5.402 0 01-.727 1.863c-.344.539-.742.817-1.195.832-.344 0-.707-.16-1.09-.48a5.582 5.582 0 01-1.031-1.149c-.305-.445-.512-.816-.621-1.113-.219-.609-.375-1.32-.469-2.133a59.542 59.542 0 01-.258-3.211c-.063-1-.117-1.726-.164-2.179-.125-1.281-.328-2.246-.609-2.895-.282-.648-.536-1.102-.762-1.359-.227-.258-.34-.411-.34-.457-.016-.188.047-.446.188-.774.14-.328.32-.515.539-.562.187-.063.437-.094.75-.094.578 0 1.226.098 1.945.293.718.195 1.187.348 1.406.457.359.187.617.398.774.633 1.812-.078 4.734-.328 8.765-.75-.078-1.906-.18-3.164-.304-3.774a11.546 11.546 0 00-.586-1.945c-.126-.328-.188-.547-.188-.656 0-.141.211-.375.633-.703a9.655 9.655 0 011.406-.903c.516-.273.891-.41 1.125-.41.453 0 1.008.215 1.664.645.657.43 1.258.906 1.805 1.429.547.524.82.848.82.973-.015.172-.078.395-.187.668-.11.274-.258.535-.446.785-.109.156-.179 1.242-.21 3.258 4.812-.594 7.57-.961 8.273-1.102.531-.109 1.242-.312 2.133-.609 1.046-.328 1.718-.5 2.015-.516.282 0 .903.356 1.864 1.067.961.711 1.84 1.496 2.636 2.355.797.86 1.196 1.547 1.196 2.063 0 .468-.145.91-.434 1.324a5.404 5.404 0 01-1.125 1.16zm-21.996-2.344c-3.922.532-6.75 1-8.484 1.407 0 .265.023.679.07 1.242.062.734.305 1.922.727 3.562l.14.61 1.477-.141 6.117-.609c0-1.485-.016-3.508-.047-6.071zm12.563-.961c-.063-.093-.415-.14-1.055-.14-1.11 0-3.133.148-6.07.445.031 2.813.046 4.867.046 6.164 2.844-.296 4.672-.515 5.485-.656.453-.859.859-1.773 1.219-2.742.359-.969.539-1.758.539-2.367 0-.313-.055-.547-.164-.704zm-37.512 25.43c-.492.328-.989.492-1.488.492-.766 0-1.731-.289-2.895-.867-1.164-.578-2.406-1.539-3.727-2.883-1.32-1.343-2.543-3.093-3.668-5.25a41.222 41.222 0 01-4.171 3.575c-1.438 1.07-2.731 1.937-3.879 2.601-1.149.664-2.004 1.058-2.567 1.184a4.567 4.567 0 01-.89.879c-.328.242-.633.363-.914.363-.313 0-.696-.164-1.149-.492a6.269 6.269 0 01-1.195-1.125c-.344-.422-.516-.727-.516-.914.016-.188.149-.704.399-1.547.031-.125.074-.266.129-.422.054-.156.105-.336.152-.539l-1.899.937c-1.89.938-3.25 1.586-4.078 1.946-.828.359-1.445.539-1.851.539-.391 0-.864-.145-1.418-.434a5.105 5.105 0 01-1.453-1.125c-.414-.461-.621-.933-.621-1.418 0-.469.343-.98 1.031-1.535a15.207 15.207 0 012.25-1.5c.812-.445 1.351-.715 1.617-.809.172-.062.32-.093.445-.093.172 0 .258.086.258.257 0 .094-.023.235-.07.422l-.117.469a.695.695 0 00-.024.211c0 .297.188.445.563.445.187 0 .437-.039.75-.117 1.531-.422 3.258-.914 5.179-1.476.156-1.266.25-2.11.282-2.532-.625.11-.985.18-1.078.211-.235.063-.923.29-2.063.68-2.344.797-3.641 1.203-3.891 1.219-.203.015-.55-.106-1.043-.364a7.722 7.722 0 01-1.418-.961c-.453-.382-.75-.73-.89-1.043-.079-.202-.117-.335-.117-.398 0-.047.019-.09.058-.129l.129-.129c.156-.14.57-.234 1.242-.281 1.328-1.25 2.391-2.5 3.188-3.75-1.36.234-2.094.352-2.203.352-.188.015-.391-.047-.61-.188a6.094 6.094 0 01-.656-.492 8.414 8.414 0 00-.492-.399 10.922 10.922 0 01-.949-.855c-.336-.336-.504-.582-.504-.738 0-.203.105-.356.316-.457a1.42 1.42 0 01.621-.153c.203 0 .367.008.492.024.469.047.797.062.985.047 1.203-.063 2.75-.188 4.64-.375.344-.86.649-1.742.915-2.649-1.907.375-3.258.656-4.055.844-1.297.281-2.039.422-2.227.422-.359 0-.867-.27-1.523-.809a17.245 17.245 0 01-1.863-1.781c-.586-.648-.872-1.02-.856-1.113a.792.792 0 01.188-.434c.109-.132.265-.183.468-.152 1.016.125 2.305.187 3.868.187 2.171 0 4.648-.125 7.429-.375 0-.218.008-.39.024-.515 0-.813.023-1.649.07-2.508-2.109.469-3.36.703-3.75.703-.297 0-.723-.203-1.277-.609a14.27 14.27 0 01-1.571-1.336c-.492-.485-.73-.766-.715-.844a.668.668 0 01.165-.352.409.409 0 01.375-.14c.656.093 1.359.14 2.109.14 1.187 0 2.773-.132 4.758-.398a72.28 72.28 0 00.07-2.367.893.893 0 00-.199-.575 3.31 3.31 0 00-.574-.527 3.89 3.89 0 01-.551-.516.805.805 0 01-.199-.539c0-.171.191-.351.574-.539a8.297 8.297 0 011.289-.492c.476-.14.8-.211.973-.211.171 0 .601.149 1.289.446.687.297 1.316.625 1.886.984.571.36.856.656.856.891-.016.281-.086.718-.211 1.312a9.464 9.464 0 00-.164 1.008l-.024.328c.531-.141 1.172-.414 1.922-.82.047-.016.16-.074.34-.176.18-.102.324-.152.434-.152.312 0 .797.183 1.453.55.656.368 1.125.739 1.406 1.114v-.352l-.023-.961c0-.64-.02-1.093-.059-1.359a1.382 1.382 0 00-.316-.703c-.188-.203-.454-.383-.797-.539a1.273 1.273 0 01-.352-.211c-.062-.063-.086-.18-.07-.352 0-.219.14-.457.422-.715.281-.258.605-.48.972-.668.367-.187.66-.281.879-.281.438 0 1.016.149 1.735.445a8.552 8.552 0 011.886 1.055c.539.406.809.781.809 1.125 0 .266-.047.512-.141.738-.093.227-.148.364-.164.41-.156.36-.273.68-.351.961-.079.282-.126.657-.141 1.125-.016 1.204.047 2.766.188 4.688l1.007-.094a26.561 26.561 0 002.672-.351 38.126 38.126 0 002.25-.516c.5-.141.887-.238 1.16-.293.274-.055.559-.082.856-.082.422 0 1.074.266 1.957.797a15.489 15.489 0 012.391 1.758c.71.64 1.066 1.125 1.066 1.453 0 .125-.16.344-.481.656-.32.313-.676.594-1.066.844-.391.25-.695.375-.914.375-.187 0-.391-.031-.609-.094a9.987 9.987 0 01-.868-.305c-1-.343-1.98-.621-2.941-.832-.961-.211-2.207-.316-3.738-.316-1.094 0-1.907.008-2.438.023.344 2.672.821 5.11 1.43 7.313.469-.844.832-1.578 1.09-2.203.258-.625.387-1.086.387-1.383a.995.995 0 00-.118-.492 2.163 2.163 0 00-.14-.235c-.157-.249-.235-.468-.235-.656 0-.343.164-.59.493-.738.328-.149.804-.223 1.429-.223.422 0 .883.215 1.383.645.5.43.91.918 1.23 1.464.321.548.442.946.364 1.196-.829 2.344-2.235 4.711-4.219 7.101 1.437 2.844 3.156 4.266 5.156 4.266.235 0 .543-.137.926-.41.383-.273.777-.711 1.184-1.313.406-.601.734-1.378.984-2.332.094-.328.199-.586.316-.773.118-.188.223-.281.317-.281s.172.078.234.234c.062.156.094.391.094.703 0 .094-.016.313-.047.656a23.847 23.847 0 00-.094 1.641c0 1.016.086 1.891.258 2.625.172.735.406 1.5.703 2.297.156.422.273.766.352 1.031.078.266.117.523.117.774 0 .437-.16.898-.48 1.382a4.315 4.315 0 01-1.219 1.219zM62.483 20.658c-.219.031-.609.094-1.171.187l-.516.985a103.474 103.474 0 01-1.5 2.859l3.07-.469.891-.14c-.032-1-.149-1.664-.352-1.992-.078-.141-.047-.332.094-.575.141-.242.336-.48.586-.714.25-.235.484-.383.703-.446-.875.141-1.476.243-1.805.305zm9.563-13.453c-.234.297-.543.59-.926.879-.383.289-.676.433-.879.433-.297 0-.586-.023-.867-.07a11.15 11.15 0 00-1.359-.094c-.547 0-1.118.039-1.711.117l-.117 2.391-.047 1.125 6.164-.75a78.978 78.978 0 01-.258-4.031zm.562 6.773a96.73 96.73 0 00-8.132.914c.14.11.211.219.211.328a1.03 1.03 0 01-.165.493c-.093.14-.242.312-.445.515a9.74 9.74 0 01-.398.457 4.632 4.632 0 00-.61.879l-.117.211a42.644 42.644 0 002.297-.469c.641-.14 1.406-.367 2.297-.679.312-.109.605-.207.879-.293.273-.086.511-.129.715-.129.296 0 .683.168 1.16.504.476.336.906.707 1.289 1.113.383.406.574.688.574.844 0 .156-.102.351-.305.586a3.332 3.332 0 01-.726.621c-.281.18-.524.269-.727.269-.062 0-.308-.047-.738-.14-.43-.094-.973-.141-1.629-.141-.36 0-.75.023-1.172.07l-2.367.375h.023c.36.016.762.133 1.207.352.446.219.824.473 1.137.762.313.289.469.535.469.738 0 .203-.055.555-.164 1.055 2.125-.531 3.336-.797 3.633-.797.218 0 .507.148.867.445.359.297.683.629.973.996.289.367.433.606.433.715-.016.203-.16.438-.433.703-.274.266-.575.391-.903.375-1.141-.047-2.781.07-4.922.352l-.023 1.922c3.406-1 5.398-1.594 5.976-1.782.125-.031.211-.047.258-.047.266 0 .492.094.68.282a.53.53 0 01.117.351.595.595 0 01-.117.352.792.792 0 01-.328.258 191.133 191.133 0 00-6.586 2.859v4.523c1.547-1.14 3.058-2.515 4.535-4.125a49.818 49.818 0 004.09-5.086c-1.313-3.359-2.25-7.203-2.813-11.531zm10.805-4.945c-.594 0-1.031-.129-1.312-.387-.282-.258-.555-.652-.821-1.183-.281-.563-.547-.977-.797-1.243-.609-.656-1.254-1.113-1.933-1.371-.68-.257-1.02-.394-1.02-.41 0-.078.055-.14.164-.187a8.23 8.23 0 011.723-.504 10.238 10.238 0 011.863-.176c1.203 0 2.227.231 3.071.691.843.461 1.336 1.169 1.476 2.121.016.094.024.243.024.446 0 .656-.211 1.187-.633 1.594-.422.406-1.024.609-1.805.609zm-41.578 9.375c-.11.172-.383.617-.82 1.336-.438.719-.883 1.5-1.336 2.344a6.012 6.012 0 011.535 1.254c.429.492.644.894.644 1.207 0 .187-.082.386-.246.597a2.058 2.058 0 01-.656.539 1.902 1.902 0 01-.926.223 1.89 1.89 0 01-.351-.024c-1-.156-2.071-.234-3.211-.234-1.485 0-3.313.149-5.485.445a6.417 6.417 0 01-.703 2.461c-.406.797-.863 1.446-1.371 1.946s-.926.758-1.254.773c-.297 0-.597-.281-.902-.844a9.157 9.157 0 01-.762-1.957c-.203-.742-.304-1.316-.304-1.722 0-.203.038-.578.117-1.125.203-1.672.304-3.149.304-4.43 0-.609-.008-1.078-.023-1.406-.078-1.797-.211-3.242-.398-4.336-.188-1.094-.446-2.016-.774-2.766l-.187.445a37.242 37.242 0 00-.645 1.782 15.92 15.92 0 00-.457 1.804c-.172.782-.36 2.157-.562 4.125a175.918 175.918 0 01-.856 6.164c-.258 1.594-.574 2.977-.949 4.149-.281.844-.766 1.715-1.453 2.613-.688.899-1.43 1.645-2.227 2.238-.797.594-1.476.891-2.039.891-.313 0-.547-.063-.703-.187a.99.99 0 01-.328-.493 11.434 11.434 0 01-.235-1.007 18.047 18.047 0 00-.492-2.004c-.187-.602-.523-1.32-1.008-2.157-.484-.835-1.156-1.714-2.015-2.636a1.162 1.162 0 01-.141-.282c-1.297 2.188-2.773 4.036-4.429 5.543C4.53 35.185 2.702 36.236.702 36.83a1.336 1.336 0 01-.305.047c-.265 0-.398-.086-.398-.258 0-.172.148-.399.445-.68 2.734-2.625 4.981-5.839 6.739-9.644a59.333 59.333 0 004.019-11.825 8.079 8.079 0 01-.703.118c-1.766.328-2.852.515-3.258.562-.422.047-.918-.203-1.488-.75a10.522 10.522 0 01-1.535-1.863c-.454-.695-.68-1.16-.68-1.395 0-.187.137-.359.41-.515.273-.156.473-.227.598-.211.5.062 1.164.093 1.992.093 1.719 0 3.547-.132 5.484-.398.156-1.015.274-1.937.352-2.766.015-.109.023-.273.023-.492 0-.515-.058-.957-.175-1.324a9.367 9.367 0 00-.481-1.184c-.125-.218-.187-.367-.187-.445-.016-.109.14-.32.468-.633a6.952 6.952 0 011.09-.843c.399-.25.707-.375.926-.375.406 0 .976.219 1.711.656.734.437 1.391.926 1.969 1.465.578.539.867.965.867 1.277.015.234-.004.422-.059.562a1.797 1.797 0 01-.293.469c-.25.328-.453.758-.609 1.289l-.328 1.125.773-.258a62.206 62.206 0 012.016-.632c.437-.125.797-.188 1.078-.188.344 0 .84.25 1.488.75.649.5 1.231 1.067 1.746 1.699.516.633.774 1.153.774 1.559v.07c.281-.171.516-.258.703-.258.469 0 1.105.188 1.91.563.805.375 1.426.789 1.863 1.242.953-.203 2.258-.562 3.915-1.078.281-.078.999-.383 2.156-.914.109-.047.363-.164.761-.352.399-.187.719-.324.961-.41.243-.085.411-.129.504-.129.235 0 .813.309 1.735.926a22.07 22.07 0 012.554 1.992c.782.712 1.172 1.223 1.172 1.535 0 .407-.117.844-.351 1.313-.235.469-.641 1.164-1.219 2.086zm-23.32-5.109c-.547 0-1.329.093-2.344.281l-.141.562a65.927 65.927 0 01-2.074 6.914 39.44 39.44 0 01-3.012 6.516.755.755 0 01.211-.047c.141 0 .266.055.375.164.094.079.324.192.692.34.367.149.843.281 1.429.398a9.557 9.557 0 001.887.176c.422 0 .891-1.054 1.406-3.164a102.38 102.38 0 001.43-6.996c.437-2.555.656-3.949.656-4.184 0-.046.024-.136.071-.269.046-.133.07-.238.07-.316 0-.25-.219-.375-.656-.375zm16.851 2.578c-.125-.125-.531-.188-1.219-.188-.578 0-1.226.043-1.945.129-.719.086-1.391.215-2.015.387-.063.906-.094 1.82-.094 2.742.015.609.066 1.219.152 1.828s.207 1.344.363 2.203c2.031-.094 3.305-.218 3.821-.375.359-.109.64-.211.843-.304.188-1.844.282-3.453.282-4.829 0-.921-.063-1.453-.188-1.593z"/></svg>
    </div>

    <div class="preloader__cell preloader__cell--loadingPercentage absolute inset-x-0 mx-auto justify-center items-center flex ">
      <span class="preloader__cell preloader__cell--loadingPercentageNumber">
        {{ loadingPercentageNumber }}
      </span>
    </div>
  </div>
</template>

<script>
import { mapMutations } from 'vuex'
import SHEET_SHAKING from '~/assets/get-stick/shaking.webp'
import PNG_HALO from '~/assets/start/halo.png'
export default {
  data() {
    return {
      loader: {
        progress: 0
      }
    }
  },
  computed: {
    loadingPercentageNumber() {
      return Math.round(this.loader.progress * 100)
    }
  },
  methods: {
    ...mapMutations([
      'updateIsPreloaded',
      'updateCurrentSubview'
    ]),
    endPreloader() {
      this.updateCurrentSubview({ value: 'Start' })
      this.updateIsPreloaded({ value: true })
    }
  },

  mounted() {

    if (createjs) {

      const queue = new createjs.LoadQueue(true)
      const handleProgress = e => {
        this.loader.progress = e.progress
      }
      const handleComplete = () => {
        this.loader.progress = 1
        this.endPreloader()
      }
      queue.on('progress', handleProgress)
      queue.on('complete', handleComplete)
      queue.loadManifest([
        SHEET_SHAKING,
        PNG_HALO
      ])
    }
  }
}
</script>

<style lang="postcss">
.preloader {
  &__cell {
    &--loadingText {
      width: 21.6%;
      padding-bottom: calc(21.6% / 4.26);
    }
    &--loadingPercentage {
      width: 21.6%;
      top: calc(50% + 5vw);
      

      &::after {
        content: '';
        width: 3.46vw;
        height: 4vw;
        display: inline-block;
        background-image: url(~assets/preloader/percentage.png);
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
        margin-left: 2.5px;
      }
    }

    &--loadingPercentageNumber {
      color: #ffe6c8;
      
      
    }
  }
}
</style>